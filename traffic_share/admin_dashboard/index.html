<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Share Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .sidebar { min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .sidebar .nav-link { color: rgba(255,255,255,0.8); padding: 12px 20px; margin: 2px 0; border-radius: 8px; transition: all 0.3s; }
        .sidebar .nav-link:hover, .sidebar .nav-link.active { background: rgba(255,255,255,0.1); color: white; }
        .card { border: none; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .stat-card .card-body { padding: 1.5rem; }
        .stat-number { font-size: 2.5rem; font-weight: bold; }
        .table { border-radius: 10px; overflow: hidden; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h4 class="text-white"><i class="fas fa-wifi"></i> Traffic Share</h4>
                        <small class="text-white-50">Admin Dashboard</small>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link active" href="#dashboard" onclick="showSection('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                        <li class="nav-item"><a class="nav-link" href="#users" onclick="showSection('users')"><i class="fas fa-users"></i> Users</a></li>
                        <li class="nav-item"><a class="nav-link" href="#buyers" onclick="showSection('buyers')"><i class="fas fa-shopping-cart"></i> Buyers</a></li>
                        <li class="nav-item"><a class="nav-link" href="#traffic" onclick="showSection('traffic')"><i class="fas fa-chart-line"></i> Traffic</a></li>
                        <li class="nav-item"><a class="nav-link" href="#payments" onclick="showSection('payments')"><i class="fas fa-credit-card"></i> Payments</a></li>
                        <li class="nav-item"><a class="nav-link" href="#settings" onclick="showSection('settings')"><i class="fas fa-cog"></i> Settings</a></li>
                    </ul>
                </div>
            </nav>
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2" id="page-title">Dashboard</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="refreshData()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>
                <div id="dashboard-section">
                    <div class="row mb-4">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-uppercase mb-1">Total Users</div>
                                            <div class="stat-number" id="total-users">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-users fa-2x"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-uppercase mb-1">Active Sessions</div>
                                            <div class="stat-number" id="active-sessions">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-wifi fa-2x"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-uppercase mb-1">Traffic Today</div>
                                            <div class="stat-number" id="traffic-today">0 GB</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-chart-line fa-2x"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-uppercase mb-1">Revenue</div>
                                            <div class="stat-number" id="revenue">$0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-dollar-sign fa-2x"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-8 col-lg-7">
                            <div class="card">
                                <div class="card-header"><h6 class="m-0 font-weight-bold text-primary">Traffic Over Time</h6></div>
                                <div class="card-body"><canvas id="trafficChart"></canvas></div>
                            </div>
                        </div>
                        <div class="col-xl-4 col-lg-5">
                            <div class="card">
                                <div class="card-header"><h6 class="m-0 font-weight-bold text-primary">User Distribution</h6></div>
                                <div class="card-body"><canvas id="userChart"></canvas></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="users-section" style="display: none;">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Users Management</h5>
                            <button class="btn btn-primary btn-sm" onclick="showAddUserModal()"><i class="fas fa-plus"></i> Add User</button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="users-table">
                                    <thead>
                                        <tr><th>ID</th><th>Telegram ID</th><th>Username</th><th>Balance</th><th>Status</th><th>Created</th><th>Actions</th></tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="buyers-section" style="display: none;">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Buyers Management</h5>
                            <button class="btn btn-primary btn-sm" onclick="showAddBuyerModal()"><i class="fas fa-plus"></i> Add Buyer</button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="buyers-table">
                                    <thead>
                                        <tr><th>ID</th><th>Name</th><th>Contact</th><th>Region</th><th>Status</th><th>Created</th><th>Actions</th></tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="traffic-section" style="display: none;">
                    <div class="card">
                        <div class="card-header"><h5 class="mb-0">Traffic Sessions</h5></div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="traffic-table">
                                    <thead>
                                        <tr><th>Session ID</th><th>User</th><th>Status</th><th>Data Transferred</th><th>Start Time</th><th>Duration</th></tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="payments-section" style="display: none;">
                    <div class="card">
                        <div class="card-header"><h5 class="mb-0">Payment Requests</h5></div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="payments-table">
                                    <thead>
                                        <tr><th>ID</th><th>User</th><th>Amount</th><th>Method</th><th>Status</th><th>Requested</th><th>Actions</th></tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="settings-section" style="display: none;">
                    <div class="card">
                        <div class="card-header"><h5 class="mb-0">System Settings</h5></div>
                        <div class="card-body">
                            <form id="settings-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="price-per-gb" class="form-label">Price per GB ($)</label>
                                            <input type="number" class="form-control" id="price-per-gb" step="0.01" value="0.50">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="min-withdrawal" class="form-label">Minimum Withdrawal ($)</label>
                                            <input type="number" class="form-control" id="min-withdrawal" step="0.01" value="5.00">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="max-withdrawal" class="form-label">Maximum Withdrawal ($)</label>
                                            <input type="number" class="form-control" id="max-withdrawal" step="0.01" value="1000.00">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="allowed-regions" class="form-label">Allowed Regions</label>
                                            <input type="text" class="form-control" id="allowed-regions" value="US,EU,CA,AU">
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Settings</button>
                            </form>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = 'http://localhost:8000/api';
        let authToken = 'your-admin-token';
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            initializeCharts();
            setInterval(loadDashboardData, 30000);
        });
        function showSection(section) {
            document.querySelectorAll('[id$="-section"]').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            document.getElementById(section + '-section').style.display = 'block';
            document.querySelector(`[href="#${section}"]`).classList.add('active');
            document.getElementById('page-title').textContent = section.charAt(0).toUpperCase() + section.slice(1);
            if (section === 'users') loadUsers();
            else if (section === 'buyers') loadBuyers();
            else if (section === 'traffic') loadTraffic();
            else if (section === 'payments') loadPayments();
        }
        async function loadDashboardData() {
            try {
                const response = await fetch(`${API_BASE}/admin/reports/daily`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                document.getElementById('total-users').textContent = data.active_users || 0;
                document.getElementById('active-sessions').textContent = data.active_sessions || 0;
                document.getElementById('traffic-today').textContent = (data.total_traffic_gb || 0) + ' GB';
                document.getElementById('revenue').textContent = '$' + (data.total_payments || 0);
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }
        async function loadUsers() {
            try {
                const response = await fetch(`${API_BASE}/admin/users`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const users = await response.json();
                const tbody = document.querySelector('#users-table tbody');
                tbody.innerHTML = users.map(user => `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.telegram_id}</td>
                        <td>${user.username || 'N/A'}</td>
                        <td>$${user.balance.toFixed(2)}</td>
                        <td><span class="badge ${user.is_active ? 'bg-success' : 'bg-danger'}">${user.is_active ? 'Active' : 'Inactive'}</span></td>
                        <td>${new Date(user.created_at).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="editUser(${user.id})">Edit</button>
                            <button class="btn btn-sm btn-outline-danger" onclick="banUser(${user.id})">Ban</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }
        async function loadBuyers() {
            try {
                const response = await fetch(`${API_BASE}/admin/buyers`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const buyers = await response.json();
                const tbody = document.querySelector('#buyers-table tbody');
                tbody.innerHTML = buyers.map(buyer => `
                    <tr>
                        <td>${buyer.id}</td>
                        <td>${buyer.name}</td>
                        <td>${buyer.contact || 'N/A'}</td>
                        <td>${buyer.region || 'N/A'}</td>
                        <td><span class="badge ${buyer.is_active ? 'bg-success' : 'bg-danger'}">${buyer.is_active ? 'Active' : 'Inactive'}</span></td>
                        <td>${new Date(buyer.created_at).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="editBuyer(${buyer.id})">Edit</button>
                            <button class="btn btn-sm btn-outline-info" onclick="manageTokens(${buyer.id})">Tokens</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading buyers:', error);
            }
        }
        function initializeCharts() {
            const trafficCtx = document.getElementById('trafficChart').getContext('2d');
            new Chart(trafficCtx, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                    datasets: [{
                        label: 'Traffic (GB)',
                        data: [12, 19, 3, 5, 2, 3],
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: true } } }
            });
            const userCtx = document.getElementById('userChart').getContext('2d');
            new Chart(userCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Active', 'Inactive', 'Banned'],
                    datasets: [{
                        data: [300, 50, 100],
                        backgroundColor: ['rgb(54, 162, 235)', 'rgb(255, 205, 86)', 'rgb(255, 99, 132)']
                    }]
                },
                options: { responsive: true }
            });
        }
        function refreshData() {
            loadDashboardData();
            if (document.getElementById('users-section').style.display !== 'none') loadUsers();
            if (document.getElementById('buyers-section').style.display !== 'none') loadBuyers();
        }
        function showAddUserModal() { alert('Add User functionality will be implemented'); }
        function showAddBuyerModal() { alert('Add Buyer functionality will be implemented'); }
        function editUser(userId) { alert(`Edit user ${userId}`); }
        function banUser(userId) { if (confirm('Are you sure you want to ban this user?')) { alert(`Ban user ${userId}`); } }
        function editBuyer(buyerId) { alert(`Edit buyer ${buyerId}`); }
        function manageTokens(buyerId) { alert(`Manage tokens for buyer ${buyerId}`); }
    </script>
</body>
</html>
